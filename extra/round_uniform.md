# 円内ランダム点生成における半径の分布変換の問題

## 背景

半径 $R$ の円内に点をランダムに配置する際、面積に対して一様な分布（すなわち、どの小領域においても点が存在する確率がその面積に比例する）が望まれます。  
しかし、中心からの距離 $r$ を単純に $\mathrm{Uniform}(0, R)$ で生成すると、環状領域の面積が  
$$
dA = 2\pi r\,dr
$$  
と $r$ に依存するため、点は外側に偏りやすくなります。  
これを補正するため、乱数 $u \sim \mathrm{Uniform}(0,1)$ を用いて  
$$
r = R\sqrt{u}
$$  
という変換が用いられます。

## (a) $\mathrm{Uniform}(0, R)$ を用いた場合

1. **累積分布関数と確率密度関数の導出**  
   $r$ を $\mathrm{Uniform}(0, R)$ に従うと仮定すると、累積分布関数は  
   $$
   F(r) = \frac{r}{R} \quad (0 \le r \le R)
   $$
   となり、対応する確率密度関数は  
   $$
   f(r) = \frac{d}{dr} F(r) = \frac{1}{R} \quad (0 \le r \le R)
   $$  
   となります。

2. **面積に対する不均一性の説明**  
   円の環状領域 $[r, r+dr]$ の面積は  
   $$
   dA = 2\pi r\,dr
   $$  
   です。  
   もし $f(r)=\frac{1}{R}$ であれば、環に入る確率は  
   $$
   f(r)\,dr = \frac{dr}{R}
   $$  
   となります。  
   しかし実際の環の面積は $r$ に比例して大きくなるため、外側（大きな $r$ の領域）の面積は増大しますが、確率は一定のままとなり、結果として外側に点が多く配置されることになります。

## (b) 面積一様分布を実現するための変換

1. **累積分布関数の導出**  
   乱数 $u$ を $\mathrm{Uniform}(0,1)$ で生成し、変換  
   $$
   r = R\sqrt{u}
   $$
   を用いると、逆変換は  
   $$
   u = \left(\frac{r}{R}\right)^2.
   $$
   したがって、$r$ の累積分布関数は  
   $$
   F(r) = P(r \le r_0) = P\left(u \le \left(\frac{r_0}{R}\right)^2\right) = \left(\frac{r_0}{R}\right)^2 \quad (0 \le r_0 \le R)
   $$  
   となります。

2. **確率密度関数の導出**  
   上記の累積分布関数から、確率密度関数は  
   $$
   f(r) = \frac{d}{dr} F(r) = \frac{d}{dr}\left(\frac{r}{R}\right)^2 = \frac{2r}{R^2} \quad (0 \le r \le R)
   $$  
   となります。

3. **面積一様分布の整合性の確認**  
   円の環状領域の面積は  
   $$
   dA = 2\pi r\,dr
   $$  
   です。  
   得られた確率  
   $$
   f(r)\,dr = \frac{2r}{R^2}\,dr
   $$  
   は、環の面積 $r\,dr$ に比例しており、これにより各環に対して面積に比例した確率で点が生成されるため、円全体で面積一様な分布が実現されます。

## (c) (a) と (b) の比較

- **$\mathrm{Uniform}(0,R)$ で生成する場合：**  
  確率密度関数は $f(r)=\frac{1}{R}$ で一定ですが、環状領域の面積が $2\pi r\,dr$ と $r$ に依存して増大するため、外側の領域に点が偏って生成される結果となります。

- **変換 $r = R\sqrt{u}$ を用いる場合：**  
  この方法では、確率密度関数が $f(r)=\frac{2r}{R^2}$ となり、環の面積 $r\,dr$ に比例するため、どの環も面積に合わせた確率で点が生成され、真の意味で面積一様な分布が得られます。

## (d) 期待値の計算

面積一様分布の場合、確率密度関数は $f(r)=\frac{2r}{R^2}$ です。  
中心からの距離 $r$ の期待値 $E[r]$ は、

$$
E[r] = \int_0^R r\, f(r)\,dr = \int_0^R r \cdot \frac{2r}{R^2}\,dr = \frac{2}{R^2}\int_0^R r^2\,dr.
$$

ここで、
$$
\int_0^R r^2\,dr = \frac{R^3}{3},
$$

なので、

$$
E[r] = \frac{2}{R^2} \cdot \frac{R^3}{3} = \frac{2R}{3}.
$$

---

# まとめ

この問題を通して、単に $r$ を $\mathrm{Uniform}(0,R)$ で生成する方法では円内の面積に対して一様な分布が得られない理由と、  
面積一様な分布を実現するために $r = R\sqrt{u}$ という変換が必要である理由を理解できます。  
また、各方法での累積分布関数、確率密度関数の導出、および期待値の計算を通して、確率分布の変換の手法について学ぶことができます.
